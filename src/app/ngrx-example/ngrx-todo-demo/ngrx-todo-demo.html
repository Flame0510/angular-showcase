@if (vm$ | async; as vm) {
<div class="todo-container">
  <div class="todo-main">
    <h2>Todo List Example</h2>

    <div class="todo-input-section">
      <input
        type="text"
        class="todo-input"
        placeholder="Cosa devi fare?"
        [(ngModel)]="newTodoText"
        (keyup.enter)="addTodo()"
      />
      <button class="btn btn-add" (click)="addTodo()">
        <span class="btn-icon">‚ûï</span> Aggiungi
      </button>
    </div>

    <div class="todo-filters">
      <button
        class="filter-btn"
        [class.active]="vm.todoState.filter === 'all'"
        (click)="setFilter('all')"
      >
        Tutti ({{ vm.todoState.todos.length }})
      </button>
      <button
        class="filter-btn"
        [class.active]="vm.todoState.filter === 'active'"
        (click)="setFilter('active')"
      >
        Attivi ({{ vm.activeTodosCount }})
      </button>
      <button
        class="filter-btn"
        [class.active]="vm.todoState.filter === 'completed'"
        (click)="setFilter('completed')"
      >
        Completati ({{ vm.completedTodosCount }})
      </button>
    </div>

    <div class="todo-list">
      @for (todo of vm.filteredTodos; track todo.id) {
      <div class="todo-item" [class.completed]="todo.completed">
        <input
          type="checkbox"
          class="todo-checkbox"
          [checked]="todo.completed"
          (change)="toggleTodo(todo.id)"
        />
        <span class="todo-text">{{ todo.text }}</span>
        <button class="btn-delete" (click)="deleteTodo(todo.id)">üóëÔ∏è</button>
      </div>
      } @empty {
      <div class="todo-empty">
        @if (vm.todoState.filter === 'all') { Nessun todo ancora. Aggiungine uno! } @else if
        (vm.todoState.filter === 'active') { Nessun todo attivo! üéâ } @else { Nessun todo completato
        ancora. }
      </div>
      }
    </div>

    @if (vm.completedTodosCount > 0) {
    <div class="todo-footer">
      <button class="btn btn-clear-completed" (click)="clearCompleted()">Elimina completati</button>
    </div>
    }
  </div>

  <div class="todo-sidebar">
    <div class="actions-log">
      <div class="log-header">
        <h3>‚ö° Actions Log</h3>
        <button class="btn-clear" (click)="clearLogs()">Clear</button>
      </div>
      <div class="log-list">
        @if (vm.actionsLog.length === 0) {
        <div class="log-empty">Nessuna action ancora...</div>
        } @for (action of vm.actionsLog; track $index) {
        <div class="log-item">
          <span class="log-time">{{ $index + 1 }}</span>
          <span class="log-action">{{ action }}</span>
        </div>
        }
      </div>
    </div>

    <div class="state-preview">
      <h3>üè™ Current State</h3>
      <pre><code>{{ vm.todoState | json }}</code></pre>
    </div>
  </div>
</div>
}
